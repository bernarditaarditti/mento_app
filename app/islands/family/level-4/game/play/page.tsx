"use client"

import { useState, useEffect, useRef } from "react"
import Image from "next/image"
import { useRouter, usePathname } from "next/navigation"
import { BackButton } from "@/components/back-button"
import useProgress from "@/hooks/use-progress"
import { useAuth } from "@/context/AuthContext"

export default function FamilyLevel4PlayPage() {
  const router = useRouter()
  const pathname = usePathname()
  const { user, isLoading: authLoading } = useAuth()
  const { saveProgress, completarNivelActual } = useProgress()
  const [showGame, setShowGame] = useState(false)
  const [selectedNegative, setSelectedNegative] = useState<number | null>(null)
  const [selectedPositive, setSelectedPositive] = useState<number | null>(null)
  const [completedPairs, setCompletedPairs] = useState<Set<string>>(new Set())
  const [showErrorPopup, setShowErrorPopup] = useState(false)
  const [showSuccessPopup, setShowSuccessPopup] = useState(false)
  const negativeRefs = useRef<(HTMLButtonElement | null)[]>([])
  const positiveRefs = useRef<(HTMLButtonElement | null)[]>([])
  
  // Definir los pares correctos: [negativo, positivo]
  const correctPairs: [number, number][] = [
    [0, 1], // "Esto destruye nuestra vida" -> "Podemos apoyarnos m√°s como familia"
    [1, 0], // "Nunca vamos a poder salir adelante" -> "Vamos a aprender a organizar mejor los gastos"
    [2, 2], // "Todo empeora" -> "Quiz√°s encontremos formas nuevas de resolver juntos"
  ]
  
  // Pensamientos negativos (columna izquierda)
  const negativeThoughts = [
    "Esto destruye nuestra vida",
    "Nunca vamos a poder salir adelante",
    "Todo empeora"
  ]
  
  // Reinterpretaciones positivas (columna derecha)
  const positiveReinterpretations = [
    "Vamos a aprender a organizar mejor los gastos",
    "Podemos apoyarnos m√°s como familia",
    "Quiz√°s encontremos formas nuevas de resolver juntos"
  ]
  
  // Mostrar el escenario por 3 segundos
  useEffect(() => {
    const timer = setTimeout(() => {
      setShowGame(true)
    }, 3000)
    
    return () => clearTimeout(timer)
  }, [])


  const handleNegativeClick = (index: number) => {
    // Si ya est√° completada, no permitir selecci√≥n
    if (isCompleted('negative', index)) return
    
    // Si ya est√° seleccionada, deseleccionar
    if (selectedNegative === index) {
      setSelectedNegative(null)
    } else {
      setSelectedNegative(index)
      // Si hab√≠a una positiva seleccionada, limpiarla
      if (selectedPositive !== null) {
        setSelectedPositive(null)
      }
    }
  }

  const handlePositiveClick = (index: number) => {
    // Si ya est√° completada, no permitir selecci√≥n
    if (isCompleted('positive', index)) return
    
    // Solo se puede seleccionar si hay un negativo seleccionado
    if (selectedNegative === null) return
    
    // Si ya est√° seleccionada, deseleccionar
    if (selectedPositive === index) {
      setSelectedPositive(null)
    } else {
      setSelectedPositive(index)
    }
  }

  const isCompleted = (type: 'negative' | 'positive', index: number) => {
    if (type === 'negative') {
      return completedPairs.has(`negative-${index}`)
    } else {
      return completedPairs.has(`positive-${index}`)
    }
  }

  const handleSubmit = () => {
    // Debe haber una opci√≥n negativa y una positiva seleccionadas
    if (selectedNegative === null || selectedPositive === null) return
    
    // Verificar si el par es correcto
    const isCorrect = correctPairs.some(([neg, pos]) => 
      neg === selectedNegative && pos === selectedPositive
    )
    
    if (isCorrect) {
      // Agregar el par a los completados
      const newCompleted = new Set(completedPairs)
      newCompleted.add(`negative-${selectedNegative}`)
      newCompleted.add(`positive-${selectedPositive}`)
      setCompletedPairs(newCompleted)
      
      // Limpiar selecciones
      setSelectedNegative(null)
      setSelectedPositive(null)
      
      // Verificar si se completaron todos los pares
      if (newCompleted.size === negativeThoughts.length * 2) {
        // Todos los pares completados - mostrar popup de √©xito
        setShowSuccessPopup(true)
        localStorage.setItem("family_level_4_completed", "true")
      }
    } else {
      // Par incorrecto - mostrar bot√≥n volver a intentar
      setShowErrorPopup(true)
    }
  }

  const handleSuccessPopupClick = async () => {
    const path = pathname || (typeof window !== "undefined" ? window.location.pathname : "")
    const levelMatch = path.match(/level-(\d+)/)
    const levelNum = levelMatch ? parseInt(levelMatch[1], 10) : 4
    const islandMatch = path.match(/islands\/([^\/]+)/)
    const islandKey = islandMatch ? islandMatch[1] : "family"
    const ISLAND_MAP: Record<string, number> = { work: 1, family: 2, relationships: 3, health: 4 }
    const idIsla = ISLAND_MAP[islandKey] ?? 2

    console.log(`üéÆ Guardando progreso nivel ${levelNum}: isla=${idIsla}`)
    console.log(`üë§ Usuario actual:`, user)

    if (!user || !user.id_usuario) {
      console.error("‚ùå No hay usuario logueado, redirigiendo a login...")
      router.push("/login")
      return
    }

    try {
      // Marcar el nivel como completado en la base de datos
      const resultCompletar = await completarNivelActual(idIsla, levelNum)
      console.log("üìä Resultado de completarNivelActual:", resultCompletar)
      
      if (!resultCompletar.success) {
        console.error("‚ùå Error al completar nivel:", resultCompletar.message)
      }
      
      // Tambi√©n guardar el progreso (nivel actual) por si acaso
      const resultSave = await saveProgress(idIsla, levelNum + 1)
      console.log("üíæ Resultado de saveProgress:", resultSave)
    } catch (e: any) {
      console.error("‚ùå Error en handleSuccessPopupClick:", e)
      console.error("Stack:", e?.stack)
    }

    router.push(`/islands/${islandKey}`)
  }

  const handleRetry = () => {
    // Limpiar selecciones pero mantener los pares completados
    setSelectedNegative(null)
    setSelectedPositive(null)
    setShowErrorPopup(false)
  }

  const getNegativeStyle = (index: number) => {
    // Si est√° completada, desvanecer pero mantener el espacio
    if (isCompleted('negative', index)) {
      return { 
        backgroundColor: "#FF6464", 
        opacity: 0,
        visibility: 'hidden' as const,
        transition: 'opacity 0.3s ease, visibility 0.3s ease'
      }
    }
    
    // Si est√° seleccionada, color
    if (selectedNegative === index) {
      return { backgroundColor: "#F9B702", opacity: 1 }
    }
    
    // Estado inicial: FF6464
      return { backgroundColor: "#FF6464", opacity: 1 }
  }

  const getPositiveStyle = (index: number) => {
    // Si est√° completada, desvanecer pero mantener el espacio
    if (isCompleted('positive', index)) {
      return { 
        backgroundColor: "#00B46F", 
        opacity: 0,
        visibility: 'hidden' as const,
        transition: 'opacity 0.3s ease, visibility 0.3s ease'
      }
    }
    
    // Si est√° seleccionada, color
    if (selectedPositive === index) {
      return { backgroundColor: "#F9B702", opacity: 1 }
    }
    
    // Estado inicial: 00B46F
    return { backgroundColor: "#00B46F", opacity: 1 }
  }

  // Pantalla inicial del escenario
  if (!showGame) {
    return (
      <div 
        className="min-h-screen flex flex-col items-center justify-center px-4 relative"
        style={{ backgroundColor: "#FFCF4A" }}
      >
        {/* Scenario Text - centered at top */}
        <div className="absolute top-44 left-0 right-0 flex justify-center">
          <h1
            className="text-center text-white font-semibold px-4"
            style={{ 
              fontFamily: "var(--font-poppins)",
              fontSize: "32px"
            }}
          >
            Escenario:
            <br />
            La familia recibe
            <br />
            la noticia de un
            <br />
            recorte de ingresos
          </h1>
        </div>

        {/* Brain Character - centered */}
        <div className="flex items-center justify-center flex-1 pt-24">
          <Image
            src="/images/cerebro-familia.png"
            alt="Cerebro familia"
            width={270}
            height={232}
            className="object-contain"
          />
        </div>
      </div>
    )
  }

  return (
    <div className="min-h-screen flex flex-col bg-white">
      {/* Header with Back Button */}
      <div className="px-4 pt-6 pb-2 relative flex-shrink-0">
        {/* Back Button */}
        <div className="absolute top-10 left-10 z-10">
          <BackButton />
        </div>
      </div>

      {/* Main Content */}
      <div className="flex-1 px-4 pb-20 flex flex-col gap-6 max-w-sm mx-auto w-full pt-16">
        {/* Scenario Box - Pink */}
        <div
          className="rounded-2xl p-4 mx-auto"
          style={{ backgroundColor: "#FFC7D1", maxWidth: "90%" }}
        >
          <div className="flex flex-col gap-2" style={{ fontFamily: "var(--font-poppins)" }}>
            <div className="text-center font-medium" style={{ color: "#F36E86", fontSize: "15px" }}>
              <p>La familia recibe la noticia de un recorte de ingresos</p>
              <p className="font-bold">Aparecen tres pensamientos autom√°ticos negativos y el usuario debe transformarlos</p>
            </div>
          </div>
        </div>

        {/* Instructions */}
        <h2
          className="text-center"
          style={{ 
            color: "#FFC832", 
            fontFamily: "var(--font-poppins)",
            fontSize: "15px",
            marginTop: "8px"
          }}
        >
          Selecciona un pensamiento negativo y luego su reinterpretaci√≥n positiva correspondiente
        </h2>

        {/* Two Columns Layout */}
        <div className="flex gap-6 relative justify-center" style={{ minHeight: "200px", marginTop: "8px" }}>
          {/* Left Column - Negative Thoughts */}
          <div className="flex flex-col gap-3" style={{ maxWidth: "42%" }}>
            <h3
              className="text-center mb-1"
              style={{ 
                color: "#FF6464", 
                fontFamily: "var(--font-poppins)",
                fontSize: "15px",
                fontWeight: "600"
              }}
            >
              Pensamiento Negativo
            </h3>
            {negativeThoughts.map((thought, index) => (
              <button
                key={index}
                ref={(el) => { negativeRefs.current[index] = el }}
                onClick={() => handleNegativeClick(index)}
                className="rounded-xl p-3 text-center transition-all flex items-center justify-center"
                style={{
                  ...getNegativeStyle(index),
                  color: "#FFFFFF",
                  fontFamily: "var(--font-poppins)",
                  fontWeight: 500,
                  fontSize: "13px",
                  cursor: isCompleted('negative', index) ? "default" : "pointer",
                  minHeight: "90px",
                  display: "flex",
                  pointerEvents: isCompleted('negative', index) ? "none" : "auto"
                }}
              >
                {thought}
              </button>
            ))}
          </div>

          {/* Right Column - Positive Reinterpretations */}
          <div className="flex flex-col gap-3" style={{ maxWidth: "42%" }}>
            <h3
              className="text-center mb-1"
              style={{ 
                color: "#00B46F", 
                fontFamily: "var(--font-poppins)",
                fontSize: "15px",
                fontWeight: "600"
              }}
            >
              Reinterpretaci√≥n Positiva
            </h3>
            {positiveReinterpretations.map((reinterpretation, index) => (
              <button
                key={index}
                ref={(el) => { positiveRefs.current[index] = el }}
                onClick={() => handlePositiveClick(index)}
                className="rounded-xl p-3 text-center transition-all flex items-center justify-center"
                style={{
                  ...getPositiveStyle(index),
                  color: "#FFFFFF",
                  fontFamily: "var(--font-poppins)",
                  fontWeight: 500,
                  fontSize: "13px",
                  cursor: isCompleted('positive', index) ? "default" : selectedNegative === null ? "not-allowed" : "pointer",
                  minHeight: "90px",
                  display: "flex",
                  pointerEvents: isCompleted('positive', index) ? "none" : "auto"
                }}
                disabled={selectedNegative === null || isCompleted('positive', index)}
              >
                {reinterpretation}
              </button>
            ))}
          </div>
        </div>
      </div>

      {/* Popup de √©xito cuando se completan todos los pares */}
      {showSuccessPopup && (
        <div 
          className="fixed inset-0 bg-black/40 z-50 flex justify-center px-4 cursor-pointer"
          style={{ alignItems: "center", paddingTop: "100px" }}
          onClick={handleSuccessPopupClick}
        >
          <div className="relative w-full max-w-xs">
            <div
              className="rounded-3xl p-6 shadow-2xl relative"
              style={{ backgroundColor: "#5CD98C" }}
            >
              {/* Content */}
              <div className="flex flex-col gap-3" style={{ fontFamily: "var(--font-poppins)" }}>
                <h3
                  className="text-lg text-center text-white"
                  style={{ fontSize: "20px" }}
                >
                  ¬°MUY BIEN!
                </h3>
                <p
                  className="text-center text-white"
                  style={{ fontSize: "16px" }}
                >
                  Pudiste transformar un pensamiento negativo en uno m√°s realista y positivo. Ese es un gran paso para cuidar tu bienestar emocional
                </p>
              </div>
            </div>
          </div>
        </div>
      )}

       {/* Popup de error cuando se elige una combinaci√≥n err√≥nea */}
       {showErrorPopup && (
         <div 
           className="fixed inset-0 bg-black/40 z-50 flex justify-center items-center px-4 cursor-pointer"
            onClick={handleRetry}
         >
           <div className="relative w-full max-w-xs flex justify-center">
             <svg width="263" height="165" viewBox="0 0 263 165" fill="none" xmlns="http://www.w3.org/2000/svg">
               <rect width="263" height="165" rx="15" fill="#FF6464"/>
               <path d="M80.7046 41.495C81.0046 41.495 81.2596 41.6 81.4696 41.81C81.6796 42.02 81.7846 42.28 81.7846 42.59C81.7846 42.9 81.6796 43.16 81.4696 43.37C81.2596 43.58 81.0046 43.685 80.7046 43.685C80.3946 43.685 80.1346 43.58 79.9246 43.37C79.7146 43.16 79.6096 42.9 79.6096 42.59C79.6096 42.28 79.7146 42.02 79.9246 41.81C80.1346 41.6 80.3946 41.495 80.7046 41.495ZM79.9396 44.75H81.3646L81.5596 52.025H79.7446L79.9396 44.75ZM85.9439 39.575V50H84.2339V39.575H85.9439ZM96.754 50H95.044L89.899 42.215V50H88.189V39.56H89.899L95.044 47.33V39.56H96.754V50ZM98.4295 44.765C98.4295 43.745 98.6645 42.83 99.1345 42.02C99.6145 41.21 100.26 40.58 101.07 40.13C101.89 39.67 102.785 39.44 103.755 39.44C104.865 39.44 105.85 39.715 106.71 40.265C107.58 40.805 108.21 41.575 108.6 42.575H106.545C106.275 42.025 105.9 41.615 105.42 41.345C104.94 41.075 104.385 40.94 103.755 40.94C103.065 40.94 102.45 41.095 101.91 41.405C101.37 41.715 100.945 42.16 100.635 42.74C100.335 43.32 100.185 43.995 100.185 44.765C100.185 45.535 100.335 46.21 100.635 46.79C100.945 47.37 101.37 47.82 101.91 48.14C102.45 48.45 103.065 48.605 103.755 48.605C104.385 48.605 104.94 48.47 105.42 48.2C105.9 47.93 106.275 47.52 106.545 46.97H108.6C108.21 47.97 107.58 48.74 106.71 49.28C105.85 49.82 104.865 50.09 103.755 50.09C102.775 50.09 101.88 49.865 101.07 49.415C100.26 48.955 99.6145 48.32 99.1345 47.51C98.6645 46.7 98.4295 45.785 98.4295 44.765ZM115.356 50.105C114.386 50.105 113.491 49.88 112.671 49.43C111.861 48.97 111.216 48.335 110.736 47.525C110.266 46.705 110.031 45.785 110.031 44.765C110.031 43.745 110.266 42.83 110.736 42.02C111.216 41.21 111.861 40.58 112.671 40.13C113.491 39.67 114.386 39.44 115.356 39.44C116.336 39.44 117.231 39.67 118.041 40.13C118.861 40.58 119.506 41.21 119.976 42.02C120.446 42.83 120.681 43.745 120.681 44.765C120.681 45.785 120.446 46.705 119.976 47.525C119.506 48.335 118.861 48.97 118.041 49.43C117.231 49.88 116.336 50.105 115.356 50.105ZM115.356 48.62C116.046 48.62 116.661 48.465 117.201 48.155C117.741 47.835 118.161 47.385 118.461 46.805C118.771 46.215 118.926 45.535 118.926 44.765C118.926 43.995 118.771 43.32 118.461 42.74C118.161 42.16 117.741 41.715 117.201 41.405C116.661 41.095 116.046 40.94 115.356 40.94C114.666 40.94 114.051 41.095 113.511 41.405C112.971 41.715 112.546 42.16 112.236 42.74C111.936 43.32 111.786 43.995 111.786 44.765C111.786 45.535 111.936 46.215 112.236 46.805C112.546 47.385 112.971 47.835 113.511 48.155C114.051 48.465 114.666 48.62 115.356 48.62ZM127.779 50L125.379 45.83H124.074V50H122.364V39.575H125.964C126.764 39.575 127.439 39.715 127.989 39.995C128.549 40.275 128.964 40.65 129.234 41.12C129.514 41.59 129.654 42.115 129.654 42.695C129.654 43.375 129.454 43.995 129.054 44.555C128.664 45.105 128.059 45.48 127.239 45.68L129.819 50H127.779ZM124.074 44.465H125.964C126.604 44.465 127.084 44.305 127.404 43.985C127.734 43.665 127.899 43.235 127.899 42.695C127.899 42.155 127.739 41.735 127.419 41.435C127.099 41.125 126.614 40.97 125.964 40.97H124.074V44.465ZM137.256 50L134.856 45.83H133.551V50H131.841V39.575H135.441C136.241 39.575 136.916 39.715 137.466 39.995C138.026 40.275 138.441 40.65 138.711 41.12C138.991 41.59 139.131 42.115 139.131 42.695C139.131 43.375 138.931 43.995 138.531 44.555C138.141 45.105 137.536 45.48 136.716 45.68L139.296 50H137.256ZM133.551 44.465H135.441C136.081 44.465 136.561 44.305 136.881 43.985C137.211 43.665 137.376 43.235 137.376 42.695C137.376 42.155 137.216 41.735 136.896 41.435C136.576 41.125 136.091 40.97 135.441 40.97H133.551V44.465ZM143.029 40.955V44.015H146.629V45.41H143.029V48.605H147.079V50H141.319V39.56H147.079V40.955H143.029ZM148.615 44.765C148.615 43.745 148.85 42.83 149.32 42.02C149.8 41.21 150.445 40.58 151.255 40.13C152.075 39.67 152.97 39.44 153.94 39.44C155.05 39.44 156.035 39.715 156.895 40.265C157.765 40.805 158.395 41.575 158.785 42.575H156.73C156.46 42.025 156.085 41.615 155.605 41.345C155.125 41.075 154.57 40.94 153.94 40.94C153.25 40.94 152.635 41.095 152.095 41.405C151.555 41.715 151.13 42.16 150.82 42.74C150.52 43.32 150.37 43.995 150.37 44.765C150.37 45.535 150.52 46.21 150.82 46.79C151.13 47.37 151.555 47.82 152.095 48.14C152.635 48.45 153.25 48.605 153.94 48.605C154.57 48.605 155.125 48.47 155.605 48.2C156.085 47.93 156.46 47.52 156.73 46.97H158.785C158.395 47.97 157.765 48.74 156.895 49.28C156.035 49.82 155.05 50.09 153.94 50.09C152.96 50.09 152.065 49.865 151.255 49.415C150.445 48.955 149.8 48.32 149.32 47.51C148.85 46.7 148.615 45.785 148.615 44.765ZM167.522 39.575V40.97H164.747V50H163.037V40.97H160.247V39.575H167.522ZM174.008 50.105C173.038 50.105 172.143 49.88 171.323 49.43C170.513 48.97 169.868 48.335 169.388 47.525C168.918 46.705 168.683 45.785 168.683 44.765C168.683 43.745 168.918 42.83 169.388 42.02C169.868 41.21 170.513 40.58 171.323 40.13C172.143 39.67 173.038 39.44 174.008 39.44C174.988 39.44 175.883 39.67 176.693 40.13C177.513 40.58 178.158 41.21 178.628 42.02C179.098 42.83 179.333 43.745 179.333 44.765C179.333 45.785 179.098 46.705 178.628 47.525C178.158 48.335 177.513 48.97 176.693 49.43C175.883 49.88 174.988 50.105 174.008 50.105ZM174.008 48.62C174.698 48.62 175.313 48.465 175.853 48.155C176.393 47.835 176.813 47.385 177.113 46.805C177.423 46.215 177.578 45.535 177.578 44.765C177.578 43.995 177.423 43.32 177.113 42.74C176.813 42.16 176.393 41.715 175.853 41.405C175.313 41.095 174.698 40.94 174.008 40.94C173.318 40.94 172.703 41.095 172.163 41.405C171.623 41.715 171.198 42.16 170.888 42.74C170.588 43.32 170.438 43.995 170.438 44.765C170.438 45.535 170.588 46.215 170.888 46.805C171.198 47.385 171.623 47.835 172.163 48.155C172.703 48.465 173.318 48.62 174.008 48.62ZM183.161 39.575L182.966 46.85H181.541L181.346 39.575H183.161ZM182.306 50.105C181.996 50.105 181.736 50 181.526 49.79C181.316 49.58 181.211 49.32 181.211 49.01C181.211 48.7 181.316 48.44 181.526 48.23C181.736 48.02 181.996 47.915 182.306 47.915C182.606 47.915 182.861 48.02 183.071 48.23C183.281 48.44 183.386 48.7 183.386 49.01C183.386 49.32 183.281 49.58 183.071 49.79C182.861 50 182.606 50.105 182.306 50.105ZM65.6265 86.955V90.015H69.2265V91.41H65.6265V94.605H69.6765V96H63.9165V85.56H69.6765V86.955H65.6265ZM74.7827 96.135C74.1327 96.135 73.5477 96.02 73.0277 95.79C72.5177 95.55 72.1127 95.23 71.8127 94.83C71.5127 94.42 71.3527 93.965 71.3327 93.465H73.1027C73.1327 93.815 73.2977 94.11 73.5977 94.35C73.9077 94.58 74.2927 94.695 74.7527 94.695C75.2327 94.695 75.6027 94.605 75.8627 94.425C76.1327 94.235 76.2677 93.995 76.2677 93.705C76.2677 93.395 76.1177 93.165 75.8177 93.015C75.5277 92.865 75.0627 92.7 74.4227 92.52C73.8027 92.35 73.2977 92.185 72.9077 92.025C72.5177 91.865 72.1777 91.62 71.8877 91.29C71.6077 90.96 71.4677 90.525 71.4677 89.985C71.4677 89.545 71.5977 89.145 71.8577 88.785C72.1177 88.415 72.4877 88.125 72.9677 87.915C73.4577 87.705 74.0177 87.6 74.6477 87.6C75.5877 87.6 76.3427 87.84 76.9127 88.32C77.4927 88.79 77.8027 89.435 77.8427 90.255H76.1327C76.1027 89.885 75.9527 89.59 75.6827 89.37C75.4127 89.15 75.0477 89.04 74.5877 89.04C74.1377 89.04 73.7927 89.125 73.5527 89.295C73.3127 89.465 73.1927 89.69 73.1927 89.97C73.1927 90.19 73.2727 90.375 73.4327 90.525C73.5927 90.675 73.7877 90.795 74.0177 90.885C74.2477 90.965 74.5877 91.07 75.0377 91.2C75.6377 91.36 76.1277 91.525 76.5077 91.695C76.8977 91.855 77.2327 92.095 77.5127 92.415C77.7927 92.735 77.9377 93.16 77.9477 93.69C77.9477 94.16 77.8177 94.58 77.5577 94.95C77.2977 95.32 76.9277 95.61 76.4477 95.82C75.9777 96.03 75.4227 96.135 74.7827 96.135ZM79.2254 91.83C79.2254 91 79.3954 90.265 79.7354 89.625C80.0854 88.985 80.5554 88.49 81.1454 88.14C81.7454 87.78 82.4054 87.6 83.1254 87.6C83.7754 87.6 84.3404 87.73 84.8204 87.99C85.3104 88.24 85.7004 88.555 85.9904 88.935V87.735H87.7154V96H85.9904V94.77C85.7004 95.16 85.3054 95.485 84.8054 95.745C84.3054 96.005 83.7354 96.135 83.0954 96.135C82.3854 96.135 81.7354 95.955 81.1454 95.595C80.5554 95.225 80.0854 94.715 79.7354 94.065C79.3954 93.405 79.2254 92.66 79.2254 91.83ZM85.9904 91.86C85.9904 91.29 85.8704 90.795 85.6304 90.375C85.4004 89.955 85.0954 89.635 84.7154 89.415C84.3354 89.195 83.9254 89.085 83.4854 89.085C83.0454 89.085 82.6354 89.195 82.2554 89.415C81.8754 89.625 81.5654 89.94 81.3254 90.36C81.0954 90.77 80.9804 91.26 80.9804 91.83C80.9804 92.4 81.0954 92.9 81.3254 93.33C81.5654 93.76 81.8754 94.09 82.2554 94.32C82.6454 94.54 83.0554 94.65 83.4854 94.65C83.9254 94.65 84.3354 94.54 84.7154 94.32C85.0954 94.1 85.4004 93.78 85.6304 93.36C85.8704 92.93 85.9904 92.43 85.9904 91.86ZM94.7279 86.64C94.4179 86.64 94.1579 86.535 93.9479 86.325C93.7379 86.115 93.6329 85.855 93.6329 85.545C93.6329 85.235 93.7379 84.975 93.9479 84.765C94.1579 84.555 94.4179 84.45 94.7279 84.45C95.0279 84.45 95.2829 84.555 95.4929 84.765C95.7029 84.975 95.8079 85.235 95.8079 85.545C95.8079 85.855 95.7029 86.115 95.4929 86.325C95.2829 86.535 95.0279 86.64 94.7279 86.64ZM95.5679 87.735V96H93.8579V87.735H95.5679ZM101.983 87.6C102.633 87.6 103.213 87.735 103.723 88.005C104.243 88.275 104.648 88.675 104.938 89.205C105.228 89.735 105.373 90.375 105.373 91.125V96H103.678V91.38C103.678 90.64 103.493 90.075 103.123 89.685C102.753 89.285 102.248 89.085 101.608 89.085C100.968 89.085 100.458 89.285 100.078 89.685C99.708 90.075 99.523 90.64 99.523 91.38V96H97.813V87.735H99.523V88.68C99.803 88.34 100.158 88.075 100.588 87.885C101.028 87.695 101.493 87.6 101.983 87.6ZM109.549 89.13V93.705C109.549 94.015 109.619 94.24 109.759 94.38C109.909 94.51 110.159 94.575 110.509 94.575H111.559V96H110.209C109.439 96 108.849 95.82 108.439 95.46C108.029 95.1 107.824 94.515 107.824 93.705V89.13H106.849V87.735H107.824V85.68H109.549V87.735H111.559V89.13H109.549ZM120.71 91.665C120.71 91.975 120.69 92.255 120.65 92.505H114.335C114.385 93.165 114.63 93.695 115.07 94.095C115.51 94.495 116.05 94.695 116.69 94.695C117.61 94.695 118.26 94.31 118.64 93.54H120.485C120.235 94.3 119.78 94.925 119.12 95.415C118.47 95.895 117.66 96.135 116.69 96.135C115.9 96.135 115.19 95.96 114.56 95.61C113.94 95.25 113.45 94.75 113.09 94.11C112.74 93.46 112.565 92.71 112.565 91.86C112.565 91.01 112.735 90.265 113.075 89.625C113.425 88.975 113.91 88.475 114.53 88.125C115.16 87.775 115.88 87.6 116.69 87.6C117.47 87.6 118.165 87.77 118.775 88.11C119.385 88.45 119.86 88.93 120.2 89.55C120.54 90.16 120.71 90.865 120.71 91.665ZM118.925 91.125C118.915 90.495 118.69 89.99 118.25 89.61C117.81 89.23 117.265 89.04 116.615 89.04C116.025 89.04 115.52 89.23 115.1 89.61C114.68 89.98 114.43 90.485 114.35 91.125H118.925ZM124.103 88.935C124.353 88.515 124.683 88.19 125.093 87.96C125.513 87.72 126.008 87.6 126.578 87.6V89.37H126.143C125.473 89.37 124.963 89.54 124.613 89.88C124.273 90.22 124.103 90.81 124.103 91.65V96H122.393V87.735H124.103V88.935ZM129.86 88.95C130.15 88.57 130.545 88.25 131.045 87.99C131.545 87.73 132.11 87.6 132.74 87.6C133.46 87.6 134.115 87.78 134.705 88.14C135.305 88.49 135.775 88.985 136.115 89.625C136.455 90.265 136.625 91 136.625 91.83C136.625 92.66 136.455 93.405 136.115 94.065C135.775 94.715 135.305 95.225 134.705 95.595C134.115 95.955 133.46 96.135 132.74 96.135C132.11 96.135 131.55 96.01 131.06 95.76C130.57 95.5 130.17 95.18 129.86 94.8V99.93H128.15V87.735H129.86V88.95ZM134.885 91.83C134.885 91.26 134.765 90.77 134.525 90.36C134.295 89.94 133.985 89.625 133.595 89.415C133.215 89.195 132.805 89.085 132.365 89.085C131.935 89.085 131.525 89.195 131.135 89.415C130.755 89.635 130.445 89.955 130.205 90.375C129.975 90.795 129.86 91.29 129.86 91.86C129.86 92.43 129.975 92.93 130.205 93.36C130.445 93.78 130.755 94.1 131.135 94.32C131.525 94.54 131.935 94.65 132.365 94.65C132.805 94.65 133.215 94.54 133.595 94.32C133.985 94.09 134.295 93.76 134.525 93.33C134.765 92.9 134.885 92.4 134.885 91.83ZM140.026 88.935C140.276 88.515 140.606 88.19 141.016 87.96C141.436 87.72 141.931 87.6 142.501 87.6V89.37H142.066C141.396 89.37 140.886 89.54 140.536 89.88C140.196 90.22 140.026 90.81 140.026 91.65V96H138.316V87.735H140.026V88.935ZM151.648 91.665C151.648 91.975 151.628 92.255 151.588 92.505H145.273C145.323 93.165 145.568 93.695 146.008 94.095C146.448 94.495 146.988 94.695 147.628 94.695C148.548 94.695 149.198 94.31 149.578 93.54H151.423C151.173 94.3 150.718 94.925 150.058 95.415C149.408 95.895 148.598 96.135 147.628 96.135C146.838 96.135 146.128 95.96 145.498 95.61C144.878 95.25 144.388 94.75 144.028 94.11C143.678 93.46 143.503 92.71 143.503 91.86C143.503 91.01 143.673 90.265 144.013 89.625C144.363 88.975 144.848 88.475 145.468 88.125C146.098 87.775 146.818 87.6 147.628 87.6C148.408 87.6 149.103 87.77 149.713 88.11C150.323 88.45 150.798 88.93 151.138 89.55C151.478 90.16 151.648 90.865 151.648 91.665ZM149.863 91.125C149.853 90.495 149.628 89.99 149.188 89.61C148.748 89.23 148.203 89.04 147.553 89.04C146.963 89.04 146.458 89.23 146.038 89.61C145.618 89.98 145.368 90.485 145.288 91.125H149.863ZM155.326 89.13V93.705C155.326 94.015 155.396 94.24 155.536 94.38C155.686 94.51 155.936 94.575 156.286 94.575H157.336V96H155.986C155.216 96 154.626 95.82 154.216 95.46C153.806 95.1 153.601 94.515 153.601 93.705V89.13H152.626V87.735H153.601V85.68H155.326V87.735H157.336V89.13H155.326ZM158.342 91.83C158.342 91 158.512 90.265 158.852 89.625C159.202 88.985 159.672 88.49 160.262 88.14C160.862 87.78 161.522 87.6 162.242 87.6C162.892 87.6 163.457 87.73 163.937 87.99C164.427 88.24 164.817 88.555 165.107 88.935V87.735H166.832V96H165.107V94.77C164.817 95.16 164.422 95.485 163.922 95.745C163.422 96.005 162.852 96.135 162.212 96.135C161.502 96.135 160.852 95.955 160.262 95.595C159.672 95.225 159.202 94.715 158.852 94.065C158.512 93.405 158.342 92.66 158.342 91.83ZM165.107 91.86C165.107 91.29 164.987 90.795 164.747 90.375C164.517 89.955 164.212 89.635 163.832 89.415C163.452 89.195 163.042 89.085 162.602 89.085C162.162 89.085 161.752 89.195 161.372 89.415C160.992 89.625 160.682 89.94 160.442 90.36C160.212 90.77 160.097 91.26 160.097 91.83C160.097 92.4 160.212 92.9 160.442 93.33C160.682 93.76 160.992 94.09 161.372 94.32C161.762 94.54 162.172 94.65 162.602 94.65C163.042 94.65 163.452 94.54 163.832 94.32C164.212 94.1 164.517 93.78 164.747 93.36C164.987 92.93 165.107 92.43 165.107 91.86ZM168.508 91.86C168.508 91.01 168.678 90.265 169.018 89.625C169.368 88.975 169.848 88.475 170.458 88.125C171.068 87.775 171.768 87.6 172.558 87.6C173.558 87.6 174.383 87.84 175.033 88.32C175.693 88.79 176.138 89.465 176.368 90.345H174.523C174.373 89.935 174.133 89.615 173.803 89.385C173.473 89.155 173.058 89.04 172.558 89.04C171.858 89.04 171.298 89.29 170.878 89.79C170.468 90.28 170.263 90.97 170.263 91.86C170.263 92.75 170.468 93.445 170.878 93.945C171.298 94.445 171.858 94.695 172.558 94.695C173.548 94.695 174.203 94.26 174.523 93.39H176.368C176.128 94.23 175.678 94.9 175.018 95.4C174.358 95.89 173.538 96.135 172.558 96.135C171.768 96.135 171.068 95.96 170.458 95.61C169.848 95.25 169.368 94.75 169.018 94.11C168.678 93.46 168.508 92.71 168.508 91.86ZM178.942 86.64C178.632 86.64 178.372 86.535 178.162 86.325C177.952 86.115 177.847 85.855 177.847 85.545C177.847 85.235 177.952 84.975 178.162 84.765C178.372 84.555 178.632 84.45 178.942 84.45C179.242 84.45 179.497 84.555 179.707 84.765C179.917 84.975 180.022 85.235 180.022 85.545C180.022 85.855 179.917 86.115 179.707 86.325C179.497 86.535 179.242 86.64 178.942 86.64ZM179.782 87.735V96H178.072V87.735H179.782ZM185.612 96.135C184.832 96.135 184.127 95.96 183.497 95.61C182.867 95.25 182.372 94.75 182.012 94.11C181.652 93.46 181.472 92.71 181.472 91.86C181.472 91.02 181.657 90.275 182.027 89.625C182.397 88.975 182.902 88.475 183.542 88.125C184.182 87.775 184.897 87.6 185.687 87.6C186.477 87.6 187.192 87.775 187.832 88.125C188.472 88.475 188.977 88.975 189.347 89.625C189.717 90.275 189.902 91.02 189.902 91.86C189.902 92.7 189.712 93.445 189.332 94.095C188.952 94.745 188.432 95.25 187.772 95.61C187.122 95.96 186.402 96.135 185.612 96.135ZM185.612 94.65C186.052 94.65 186.462 94.545 186.842 94.335C187.232 94.125 187.547 93.81 187.787 93.39C188.027 92.97 188.147 92.46 188.147 91.86C188.147 91.26 188.032 90.755 187.802 90.345C187.572 89.925 187.267 89.61 186.887 89.4C186.507 89.19 186.097 89.085 185.657 89.085C185.217 89.085 184.807 89.19 184.427 89.4C184.057 89.61 183.762 89.925 183.542 90.345C183.322 90.755 183.212 91.26 183.212 91.86C183.212 92.75 183.437 93.44 183.887 93.93C184.347 94.41 184.922 94.65 185.612 94.65ZM187.232 85.38L183.917 87.015V85.755L187.232 83.925V85.38ZM195.762 87.6C196.412 87.6 196.992 87.735 197.502 88.005C198.022 88.275 198.427 88.675 198.717 89.205C199.007 89.735 199.152 90.375 199.152 91.125V96H197.457V91.38C197.457 90.64 197.272 90.075 196.902 89.685C196.532 89.285 196.027 89.085 195.387 89.085C194.747 89.085 194.237 89.285 193.857 89.685C193.487 90.075 193.302 90.64 193.302 91.38V96H191.592V87.735H193.302V88.68C193.582 88.34 193.937 88.075 194.367 87.885C194.807 87.695 195.272 87.6 195.762 87.6ZM44.8529 114.83C44.8529 114 45.0229 113.265 45.3629 112.625C45.7129 111.985 46.1829 111.49 46.7729 111.14C47.3729 110.78 48.0329 110.6 48.7529 110.6C49.4029 110.6 49.9679 110.73 50.4479 110.99C50.9379 111.24 51.3279 111.555 51.6179 111.935V110.735H53.3429V119H51.6179V117.77C51.3279 118.16 50.9329 118.485 50.4329 118.745C49.9329 119.005 49.3629 119.135 48.7229 119.135C48.0129 119.135 47.3629 118.955 46.7729 118.595C46.1829 118.225 45.7129 117.715 45.3629 117.065C45.0229 116.405 44.8529 115.66 44.8529 114.83ZM51.6179 114.86C51.6179 114.29 51.4979 113.795 51.2579 113.375C51.0279 112.955 50.7229 112.635 50.3429 112.415C49.9629 112.195 49.5529 112.085 49.1129 112.085C48.6729 112.085 48.2629 112.195 47.8829 112.415C47.5029 112.625 47.1929 112.94 46.9529 113.36C46.7229 113.77 46.6079 114.26 46.6079 114.83C46.6079 115.4 46.7229 115.9 46.9529 116.33C47.1929 116.76 47.5029 117.09 47.8829 117.32C48.2729 117.54 48.6829 117.65 49.1129 117.65C49.5529 117.65 49.9629 117.54 50.3429 117.32C50.7229 117.1 51.0279 116.78 51.2579 116.36C51.4979 115.93 51.6179 115.43 51.6179 114.86ZM63.0739 110.735V119H61.3639V118.025C61.0939 118.365 60.7389 118.635 60.2989 118.835C59.8689 119.025 59.4089 119.12 58.9189 119.12C58.2689 119.12 57.6839 118.985 57.1639 118.715C56.6539 118.445 56.2489 118.045 55.9489 117.515C55.6589 116.985 55.5139 116.345 55.5139 115.595V110.735H57.2089V115.34C57.2089 116.08 57.3939 116.65 57.7639 117.05C58.1339 117.44 58.6389 117.635 59.2789 117.635C59.9189 117.635 60.4239 117.44 60.7939 117.05C61.1739 116.65 61.3639 116.08 61.3639 115.34V110.735H63.0739ZM75.3351 110.6C75.9851 110.6 76.5651 110.735 77.0751 111.005C77.5951 111.275 78.0001 111.675 78.2901 112.205C78.5901 112.735 78.7401 113.375 78.7401 114.125V119H77.0451V114.38C77.0451 113.64 76.8601 113.075 76.4901 112.685C76.1201 112.285 75.6151 112.085 74.9751 112.085C74.3351 112.085 73.8251 112.285 73.4451 112.685C73.0751 113.075 72.8901 113.64 72.8901 114.38V119H71.1951V114.38C71.1951 113.64 71.0101 113.075 70.6401 112.685C70.2701 112.285 69.7651 112.085 69.1251 112.085C68.4851 112.085 67.9751 112.285 67.5951 112.685C67.2251 113.075 67.0401 113.64 67.0401 114.38V119H65.3301V110.735H67.0401V111.68C67.3201 111.34 67.6751 111.075 68.1051 110.885C68.5351 110.695 68.9951 110.6 69.4851 110.6C70.1451 110.6 70.7351 110.74 71.2551 111.02C71.7751 111.3 72.1751 111.705 72.4551 112.235C72.7051 111.735 73.0951 111.34 73.6251 111.05C74.1551 110.75 74.7251 110.6 75.3351 110.6ZM88.491 114.665C88.491 114.975 88.471 115.255 88.431 115.505H82.116C82.166 116.165 82.411 116.695 82.851 117.095C83.291 117.495 83.831 117.695 84.471 117.695C85.391 117.695 86.041 117.31 86.421 116.54H88.266C88.016 117.3 87.561 117.925 86.901 118.415C86.251 118.895 85.441 119.135 84.471 119.135C83.681 119.135 82.971 118.96 82.341 118.61C81.721 118.25 81.231 117.75 80.871 117.11C80.521 116.46 80.346 115.71 80.346 114.86C80.346 114.01 80.516 113.265 80.856 112.625C81.206 111.975 81.691 111.475 82.311 111.125C82.941 110.775 83.661 110.6 84.471 110.6C85.251 110.6 85.946 110.77 86.556 111.11C87.166 111.45 87.641 111.93 87.981 112.55C88.321 113.16 88.491 113.865 88.491 114.665ZM86.706 114.125C86.696 113.495 86.471 112.99 86.031 112.61C85.591 112.23 85.046 112.04 84.396 112.04C83.806 112.04 83.301 112.23 82.881 112.61C82.461 112.98 82.211 113.485 82.131 114.125H86.706ZM94.3438 110.6C94.9938 110.6 95.5738 110.735 96.0838 111.005C96.6038 111.275 97.0088 111.675 97.2988 112.205C97.5888 112.735 97.7338 113.375 97.7338 114.125V119H96.0388V114.38C96.0388 113.64 95.8538 113.075 95.4838 112.685C95.1138 112.285 94.6088 112.085 93.9688 112.085C93.3288 112.085 92.8188 112.285 92.4388 112.685C92.0688 113.075 91.8838 113.64 91.8838 114.38V119H90.1738V110.735H91.8838V111.68C92.1638 111.34 92.5188 111.075 92.9488 110.885C93.3888 110.695 93.8538 110.6 94.3438 110.6ZM101.91 112.13V116.705C101.91 117.015 101.98 117.24 102.12 117.38C102.27 117.51 102.52 117.575 102.87 117.575H103.92V119H102.57C101.8 119 101.21 118.82 100.8 118.46C100.39 118.1 100.185 117.515 100.185 116.705V112.13H99.21V110.735H100.185V108.68H101.91V110.735H103.92V112.13H101.91ZM104.926 114.83C104.926 114 105.096 113.265 105.436 112.625C105.786 111.985 106.256 111.49 106.846 111.14C107.446 110.78 108.106 110.6 108.826 110.6C109.476 110.6 110.041 110.73 110.521 110.99C111.011 111.24 111.401 111.555 111.691 111.935V110.735H113.416V119H111.691V117.77C111.401 118.16 111.006 118.485 110.506 118.745C110.006 119.005 109.436 119.135 108.796 119.135C108.086 119.135 107.436 118.955 106.846 118.595C106.256 118.225 105.786 117.715 105.436 117.065C105.096 116.405 104.926 115.66 104.926 114.83ZM111.691 114.86C111.691 114.29 111.571 113.795 111.331 113.375C111.101 112.955 110.796 112.635 110.416 112.415C110.036 112.195 109.626 112.085 109.186 112.085C108.746 112.085 108.336 112.195 107.956 112.415C107.576 112.625 107.266 112.94 107.026 113.36C106.796 113.77 106.681 114.26 106.681 114.83C106.681 115.4 106.796 115.9 107.026 116.33C107.266 116.76 107.576 117.09 107.956 117.32C108.346 117.54 108.756 117.65 109.186 117.65C109.626 117.65 110.036 117.54 110.416 117.32C110.796 117.1 111.101 116.78 111.331 116.36C111.571 115.93 111.691 115.43 111.691 114.86ZM121.269 107.9V119H119.559V107.9H121.269ZM122.944 114.83C122.944 114 123.114 113.265 123.454 112.625C123.804 111.985 124.274 111.49 124.864 111.14C125.464 110.78 126.124 110.6 126.844 110.6C127.494 110.6 128.059 110.73 128.539 110.99C129.029 111.24 129.419 111.555 129.709 111.935V110.735H131.434V119H129.709V117.77C129.419 118.16 129.024 118.485 128.524 118.745C128.024 119.005 127.454 119.135 126.814 119.135C126.104 119.135 125.454 118.955 124.864 118.595C124.274 118.225 123.804 117.715 123.454 117.065C123.114 116.405 122.944 115.66 122.944 114.83ZM129.709 114.86C129.709 114.29 129.589 113.795 129.349 113.375C129.119 112.955 128.814 112.635 128.434 112.415C128.054 112.195 127.644 112.085 127.204 112.085C126.764 112.085 126.354 112.195 125.974 112.415C125.594 112.625 125.284 112.94 125.044 113.36C124.814 113.77 124.699 114.26 124.699 114.83C124.699 115.4 124.814 115.9 125.044 116.33C125.284 116.76 125.594 117.09 125.974 117.32C126.364 117.54 126.774 117.65 127.204 117.65C127.644 117.65 128.054 117.54 128.434 117.32C128.814 117.1 129.119 116.78 129.349 116.36C129.589 115.93 129.709 115.43 129.709 114.86ZM141.041 112.13H139.511V119H137.786V112.13H136.811V110.735H137.786V110.15C137.786 109.2 138.036 108.51 138.536 108.08C139.046 107.64 139.841 107.42 140.921 107.42V108.845C140.401 108.845 140.036 108.945 139.826 109.145C139.616 109.335 139.511 109.67 139.511 110.15V110.735H141.041V112.13ZM144.267 111.935C144.517 111.515 144.847 111.19 145.257 110.96C145.677 110.72 146.172 110.6 146.742 110.6V112.37H146.307C145.637 112.37 145.127 112.54 144.777 112.88C144.437 113.22 144.267 113.81 144.267 114.65V119H142.557V110.735H144.267V111.935ZM155.798 110.735V119H154.088V118.025C153.818 118.365 153.463 118.635 153.023 118.835C152.593 119.025 152.133 119.12 151.643 119.12C150.993 119.12 150.408 118.985 149.888 118.715C149.378 118.445 148.973 118.045 148.673 117.515C148.383 116.985 148.238 116.345 148.238 115.595V110.735H149.933V115.34C149.933 116.08 150.118 116.65 150.488 117.05C150.858 117.44 151.363 117.635 152.003 117.635C152.643 117.635 153.148 117.44 153.518 117.05C153.898 116.65 154.088 116.08 154.088 115.34V110.735H155.798ZM161.055 119.135C160.405 119.135 159.82 119.02 159.3 118.79C158.79 118.55 158.385 118.23 158.085 117.83C157.785 117.42 157.625 116.965 157.605 116.465H159.375C159.405 116.815 159.57 117.11 159.87 117.35C160.18 117.58 160.565 117.695 161.025 117.695C161.505 117.695 161.875 117.605 162.135 117.425C162.405 117.235 162.54 116.995 162.54 116.705C162.54 116.395 162.39 116.165 162.09 116.015C161.8 115.865 161.335 115.7 160.695 115.52C160.075 115.35 159.57 115.185 159.18 115.025C158.79 114.865 158.45 114.62 158.16 114.29C157.88 113.96 157.74 113.525 157.74 112.985C157.74 112.545 157.87 112.145 158.13 111.785C158.39 111.415 158.76 111.125 159.24 110.915C159.73 110.705 160.29 110.6 160.92 110.6C161.86 110.6 162.615 110.84 163.185 111.32C163.765 111.79 164.075 112.435 164.115 113.255H162.405C162.375 112.885 162.225 112.59 161.955 112.37C161.685 112.15 161.32 112.04 160.86 112.04C160.41 112.04 160.065 112.125 159.825 112.295C159.585 112.465 159.465 112.69 159.465 112.97C159.465 113.19 159.545 113.375 159.705 113.525C159.865 113.675 160.06 113.795 160.29 113.885C160.52 113.965 160.86 114.07 161.31 114.2C161.91 114.36 162.4 114.525 162.78 114.695C163.17 114.855 163.505 115.095 163.785 115.415C164.065 115.735 164.21 116.16 164.22 116.69C164.22 117.16 164.09 117.58 163.83 117.95C163.57 118.32 163.2 118.61 162.72 118.82C162.25 119.03 161.695 119.135 161.055 119.135ZM168.062 112.13V116.705C168.062 117.015 168.132 117.24 168.272 117.38C168.422 117.51 168.672 117.575 169.022 117.575H170.072V119H168.722C167.952 119 167.362 118.82 166.952 118.46C166.542 118.1 166.337 117.515 166.337 116.705V112.13H165.362V110.735H166.337V108.68H168.062V110.735H170.072V112.13H168.062ZM173.358 111.935C173.608 111.515 173.938 111.19 174.348 110.96C174.768 110.72 175.263 110.6 175.833 110.6V112.37H175.398C174.728 112.37 174.218 112.54 173.868 112.88C173.528 113.22 173.358 113.81 173.358 114.65V119H171.648V110.735H173.358V111.935ZM176.835 114.83C176.835 114 177.005 113.265 177.345 112.625C177.695 111.985 178.165 111.49 178.755 111.14C179.355 110.78 180.015 110.6 180.735 110.6C181.385 110.6 181.95 110.73 182.43 110.99C182.92 111.24 183.31 111.555 183.6 111.935V110.735H185.325V119H183.6V117.77C183.31 118.16 182.915 118.485 182.415 118.745C181.915 119.005 181.345 119.135 180.705 119.135C179.995 119.135 179.345 118.955 178.755 118.595C178.165 118.225 177.695 117.715 177.345 117.065C177.005 116.405 176.835 115.66 176.835 114.83ZM183.6 114.86C183.6 114.29 183.48 113.795 183.24 113.375C183.01 112.955 182.705 112.635 182.325 112.415C181.945 112.195 181.535 112.085 181.095 112.085C180.655 112.085 180.245 112.195 179.865 112.415C179.485 112.625 179.175 112.94 178.935 113.36C178.705 113.77 178.59 114.26 178.59 114.83C178.59 115.4 178.705 115.9 178.935 116.33C179.175 116.76 179.485 117.09 179.865 117.32C180.255 117.54 180.665 117.65 181.095 117.65C181.535 117.65 181.945 117.54 182.325 117.32C182.705 117.1 183.01 116.78 183.24 116.36C183.48 115.93 183.6 115.43 183.6 114.86ZM187.001 114.86C187.001 114.01 187.171 113.265 187.511 112.625C187.861 111.975 188.341 111.475 188.951 111.125C189.561 110.775 190.261 110.6 191.051 110.6C192.051 110.6 192.876 110.84 193.526 111.32C194.186 111.79 194.631 112.465 194.861 113.345H193.016C192.866 112.935 192.626 112.615 192.296 112.385C191.966 112.155 191.551 112.04 191.051 112.04C190.351 112.04 189.791 112.29 189.371 112.79C188.961 113.28 188.756 113.97 188.756 114.86C188.756 115.75 188.961 116.445 189.371 116.945C189.791 117.445 190.351 117.695 191.051 117.695C192.041 117.695 192.696 117.26 193.016 116.39H194.861C194.621 117.23 194.171 117.9 193.511 118.4C192.851 118.89 192.031 119.135 191.051 119.135C190.261 119.135 189.561 118.96 188.951 118.61C188.341 118.25 187.861 117.75 187.511 117.11C187.171 116.46 187.001 115.71 187.001 114.86ZM197.435 109.64C197.125 109.64 196.865 109.535 196.655 109.325C196.445 109.115 196.34 108.855 196.34 108.545C196.34 108.235 196.445 107.975 196.655 107.765C196.865 107.555 197.125 107.45 197.435 107.45C197.735 107.45 197.99 107.555 198.2 107.765C198.41 107.975 198.515 108.235 198.515 108.545C198.515 108.855 198.41 109.115 198.2 109.325C197.99 109.535 197.735 109.64 197.435 109.64ZM198.275 110.735V119H196.565V110.735H198.275ZM204.106 119.135C203.326 119.135 202.621 118.96 201.991 118.61C201.361 118.25 200.866 117.75 200.506 117.11C200.146 116.46 199.966 115.71 199.966 114.86C199.966 114.02 200.151 113.275 200.521 112.625C200.891 111.975 201.396 111.475 202.036 111.125C202.676 110.775 203.391 110.6 204.181 110.6C204.971 110.6 205.686 110.775 206.326 111.125C206.966 111.475 207.471 111.975 207.841 112.625C208.211 113.275 208.396 114.02 208.396 114.86C208.396 115.7 208.206 116.445 207.826 117.095C207.446 117.745 206.926 118.25 206.266 118.61C205.616 118.96 204.896 119.135 204.106 119.135ZM204.106 117.65C204.546 117.65 204.956 117.545 205.336 117.335C205.726 117.125 206.041 116.81 206.281 116.39C206.521 115.97 206.641 115.46 206.641 114.86C206.641 114.26 206.526 113.755 206.296 113.345C206.066 112.925 205.761 112.61 205.381 112.4C205.001 112.19 204.591 112.085 204.151 112.085C203.711 112.085 203.301 112.19 202.921 112.4C202.551 112.61 202.256 112.925 202.036 113.345C201.816 113.755 201.706 114.26 201.706 114.86C201.706 115.75 201.931 116.44 202.381 116.93C202.841 117.41 203.416 117.65 204.106 117.65ZM205.726 108.38L202.411 110.015V108.755L205.726 106.925V108.38ZM214.256 110.6C214.906 110.6 215.486 110.735 215.996 111.005C216.516 111.275 216.921 111.675 217.211 112.205C217.501 112.735 217.646 113.375 217.646 114.125V119H215.951V114.38C215.951 113.64 215.766 113.075 215.396 112.685C215.026 112.285 214.521 112.085 213.881 112.085C213.241 112.085 212.731 112.285 212.351 112.685C211.981 113.075 211.796 113.64 211.796 114.38V119H210.086V110.735H211.796V111.68C212.076 111.34 212.431 111.075 212.861 110.885C213.301 110.695 213.766 110.6 214.256 110.6Z" fill="white"/>
             </svg>
           </div>
         </div>
       )}

       {/* Bottom Bar */}
       <div className="fixed bottom-0 left-0 right-0 bg-white px-4 pt-4 pb-8 flex justify-center items-center max-w-md mx-auto">
         {!showErrorPopup && (
          // Layout normal con cerebrito y bot√≥n verde
          <div className="flex justify-center items-center gap-28 w-full">
            {/* Brain Icon with Question Mark - Left */}
            <div 
              className="flex items-center cursor-pointer transition-transform hover:scale-105 active:scale-95" 
              style={{ transform: "translateY(-4px)" }}
              onClick={() => {
                if (typeof window !== "undefined") {
                  sessionStorage.setItem("reinterpretacion_positiva_return_path", pathname)
                }
                router.push("/reinterpretacion-positiva")
              }}
            >
              <svg width="78" height="74" viewBox="0 0 78 74" fill="none" xmlns="http://www.w3.org/2000/svg">
                <path d="M38.4664 61.3984C38.4664 63.4197 38.4664 68.1361 38.4664 70.8312C39.1319 70.921 40.7822 71.3163 42.0599 72.1787" stroke="#F36E86" strokeWidth="1.79672" strokeLinecap="round" strokeLinejoin="round"/>
                <path d="M24.0924 61.3984C24.0924 62.6114 24.0924 64.1156 24.0924 66.1148C24.0924 67.447 24.0924 68.999 24.0924 70.8312C23.427 70.921 21.7766 71.3163 20.499 72.1787" stroke="#F36E86" strokeWidth="1.79672" strokeLinecap="round" strokeLinejoin="round"/>
                <path d="M46.3738 63.5214C47.8584 61.1277 54.167 64.5208 55.503 62.3771C56.839 60.2333 55.4777 56.4755 55.503 55.8446" stroke="#F36E86" strokeWidth="1.79672" strokeLinecap="round"/>
                <path d="M14.6044 64.8286C13.1197 62.4349 6.81112 65.828 5.47513 63.6842C4.13915 61.5404 5.5005 57.7826 5.47512 57.1517" stroke="#F36E86" strokeWidth="1.79672" strokeLinecap="round"/>
                <path d="M47.0306 60.7579C44.2501 62.8955 39.1881 62.7174 37.0047 62.3611C31.7739 64.0379 27.4311 62.7336 25.5314 61.6823C25.5179 61.6755 25.5043 61.6679 25.4907 61.6596C25.3483 61.5796 25.2203 61.5012 25.1072 61.4259C17.942 65.3805 13.4771 62.3611 12.1404 60.3571C3.47794 59.5021 2.20353 53.1427 2.64913 50.0699C-1.73555 42.8021 3.13929 38.135 6.12479 36.7099C7.19423 29.2283 13.6999 27.8923 16.8191 28.1595C20.5622 22.7086 27.3669 25.1798 30.8426 26.783C40.4675 22.7216 46.0058 27.4914 47.0306 30.6978C55.0514 31.8735 55.7198 37.8678 55.0514 40.7179C59.3291 44.8862 56.8338 51.3614 55.0514 54.0779C54.4097 59.5288 49.4369 60.8024 47.0306 60.7579Z" fill="#FF8FA3"/>
                <path d="M55.0514 54.0779C54.4097 59.5288 49.4369 60.8024 47.0306 60.7579C44.2501 62.8955 39.1881 62.7174 37.0047 62.3611C31.7739 64.0379 27.4311 62.7336 25.5314 61.6823M55.0514 54.0779C56.8338 51.3614 59.3291 44.8862 55.0514 40.7179M55.0514 54.0779C55.0471 53.3964 54.8781 51.7395 54.2365 50.5639M55.0514 40.7179C55.7198 37.8678 55.0514 31.8735 47.0306 30.6978C46.0058 27.4914 40.4675 22.7216 30.8426 26.783M55.0514 40.7179C54.6461 40.2591 53.6483 39.3147 52.8997 39.2078M30.8426 26.783C27.3669 25.1798 20.5622 22.7086 16.8191 28.1595C13.6999 27.8923 7.19423 29.2283 6.12479 36.7099M30.8426 26.783C31.3285 27.42 32.7676 29.0202 32.4467 30.6979M6.12479 36.7099C3.13929 38.135 -1.73555 42.8021 2.64913 50.0699C2.20353 53.1427 3.47794 59.5021 12.1404 60.3571C13.4771 62.3611 17.942 65.3805 25.1072 61.4259C25.231 61.5084 25.3727 61.5944 25.5314 61.6823M6.12479 36.7099C6.65951 36.4292 8.23692 35.8678 10.2688 35.8678M21.7653 30.1635C23.0129 29.3174 26.043 28.2396 28.1819 30.6979M6.12479 49.5355C5.0108 47.1307 4.28001 42.2142 10.2688 41.7867M10.2688 52.8755C10.1797 54.0779 10.5629 56.6965 12.8088 57.5515M24.2923 59.3815C24.4946 60.0432 25.0255 61.4299 25.5314 61.6823M39.3981 29.3214C40.4229 29.4281 42.5529 30.264 42.8737 32.7546M51.4292 52.1671C51.652 53.1333 51.4559 55.3144 48.8893 56.3087" stroke="#F36E86" strokeWidth="1.79672" strokeLinecap="round" strokeLinejoin="round"/>
                <path d="M30.6259 44.4111H34.2193" stroke="black" strokeWidth="1.79672" strokeLinecap="round"/>
                <path d="M22.9495 36.8159C26.8564 36.8161 30.054 40.0531 30.054 44.0845C30.0539 48.1158 26.8563 51.3528 22.9495 51.353C19.0424 51.353 15.844 48.1159 15.844 44.0845C15.844 40.053 19.0424 36.8159 22.9495 36.8159Z" stroke="black" strokeWidth="1.79672"/>
                <path d="M41.869 36.8159C45.7939 36.816 49.0018 40.0559 49.0018 44.0845C49.0018 48.113 45.7939 51.353 41.869 51.353C37.9441 51.353 34.7363 48.113 34.7362 44.0845C34.7362 40.0559 37.9441 36.8159 41.869 36.8159Z" stroke="black" strokeWidth="1.79672"/>
                <ellipse cx="24.0183" cy="45.2388" rx="1.618" ry="2.28708" transform="rotate(-2.4504 24.0183 45.2388)" fill="black"/>
                <ellipse cx="41.1754" cy="45.0757" rx="1.618" ry="2.28708" transform="rotate(-2.4504 41.1754 45.0757)" fill="black"/>
                <path d="M29.3368 52.2515C29.2251 52.9184 29.6048 54.3058 32.017 54.5192C34.4292 54.7326 35.1439 53.0963 35.1997 52.2515" stroke="black" strokeWidth="1.63338" strokeLinecap="round"/>
                <path d="M67.9301 11.4678C70.1955 11.4678 72.0057 12.0606 73.3607 13.2462C74.7368 14.4318 75.4249 16.1044 75.4249 18.2639C75.4249 20.254 74.7686 21.8101 73.4559 22.9322C72.1645 24.0331 70.4496 24.5942 68.3112 24.6153L68.1524 26.9971H63.3888L63.2301 21.0903H65.1355C66.7657 21.0903 68.0042 20.8891 68.8511 20.4869C69.7191 20.0846 70.1532 19.3542 70.1532 18.2956C70.1532 17.5546 69.952 16.9724 69.5498 16.549C69.1475 16.1255 68.5865 15.9138 67.8666 15.9138C67.1045 15.9138 66.5117 16.1361 66.0882 16.5807C65.6648 17.0042 65.4531 17.5864 65.4531 18.3274H60.3401C60.2978 17.0359 60.5624 15.8715 61.1341 14.8341C61.7269 13.7967 62.5949 12.9816 63.7382 12.3887C64.9026 11.7748 66.2999 11.4678 67.9301 11.4678ZM65.8342 35.2541C64.8814 35.2541 64.0981 34.9788 63.4841 34.4284C62.8913 33.8567 62.5949 33.1581 62.5949 32.3324C62.5949 31.4855 62.8913 30.7763 63.4841 30.2046C64.0981 29.633 64.8814 29.3472 65.8342 29.3472C66.7657 29.3472 67.5279 29.633 68.1207 30.2046C68.7347 30.7763 69.0417 31.4855 69.0417 32.3324C69.0417 33.1581 68.7347 33.8567 68.1207 34.4284C67.5279 34.9788 66.7657 35.2541 65.8342 35.2541Z" fill="#FF8FA3"/>
              </svg>
            </div>

            {/* Checkmark Button - Right */}
            <button
              onClick={handleSubmit}
              disabled={selectedNegative === null || selectedPositive === null}
              className="transition-transform hover:scale-105 active:scale-95 disabled:opacity-50 disabled:cursor-not-allowed"
              style={{ transform: "translate(4px, 2px)" }}
            >
              <svg width="65" height="57" viewBox="0 0 65 57" fill="none" xmlns="http://www.w3.org/2000/svg">
                <rect width="65" height="57" rx="15" fill="#00C49A"/>
                <path d="M21 27.1935L29.4 37L45 18" stroke="white" strokeWidth="5" strokeLinecap="round" strokeLinejoin="round"/>
              </svg>
            </button>
          </div>
        )}
      </div>
    </div>
  )
}

